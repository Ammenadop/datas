(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{480:function(e,t,n){},583:function(e,t,n){"use strict";n(480)},655:function(e,t,n){"use strict";n.r(t);n(11);var r=n(10),c=n(9),o=(n(36),n(17)),d={data:function(){var e;return e={messages:[],myname:"",inputmessage:"",isRecording:!1,mediaRecorder:null,audioChunks:[],dataObj:null,loading:!0,load:!1},Object(c.a)(e,"myname",""),Object(c.a)(e,"corid",""),e},mounted:function(){this.getData()},methods:{backa:function(){history.back()},getData:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e,t.next=3,o.a.collection("cordinator").getFirstListItem('email="'.concat(e.$store.state.email,'"'),{});case 3:return r=t.sent,n.myname=r.name,t.next=7,o.a.collection("chats").getOne(n.$route.params.id);case 7:n.dataObj=t.sent,n.subChats(n.dataObj),o.a.collection("chatMsgs").subscribe("*",(function(e){n.subChats(n.dataObj)}),{}),n.loading=!1;case 11:case"end":return t.stop()}}),t)})))()},subChats:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t,null==e){n.next=7;break}return n.next=4,o.a.collection("chatMsgs").getFullList({sort:"-created",filter:'chatid="'.concat(e.id,'"')});case 4:c=n.sent,r.messages=c;try{r.scrollToBottom()}catch(e){}case 7:case"end":return n.stop()}}),n)})))()},scrollToBottom:function(){var e=this;try{e.$nextTick((function(){var t=e.$refs.chatWindow;t.scrollTop=t.scrollHeight}))}catch(e){}},_send:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,c,dd,d,l,dt,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e,r=function(e){var t=e.getHours(),n=e.getMinutes(),r=t>=12?"PM":"AM";return(t=(t=(t%=12)||12)<10?"0"+t:t)+":"+(n=n<10?"0"+n:n)+" "+r},c=new Date,dd=c.getDate(),d=c.getMonth()+1,l=c.getFullYear(),dt="".concat(dd<10?"0"+dd:dd,"/").concat(d<10?"0"+d:d,"/").concat(l),data={msg:n.inputmessage,msgType:"text",date:dt,time:r(c),sent_by:n.myname,sentby_id:n.$store.state.email,chatid:n.dataObj.id,sender:"Coordinator"},t.next=10,o.a.collection("chatMsgs").create(data);case 10:return t.next=12,o.a.collection("chats").update(e.dataObj.id,{lastMsg:n.inputmessage,msgType:"text",sentby:e.$store.state.email,isRead:!1});case 12:n.inputmessage="";case 13:case"end":return t.stop()}}),t)})))()},opp:function(){this.isRecording=!this.isRecording,1==this.isRecording?this.startRecording():0==this.isRecording&&this.stopRecording()},startRecording:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:n=t.sent,e.mediaRecorder=new MediaRecorder(n),e.audioChunks=[],e.mediaRecorder.ondataavailable=function(t){e.audioChunks.push(t.data)},e.mediaRecorder.start(),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:case"end":return t.stop()}}),t,null,[[0,10]])})))()},stopRecording:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,c,d,l,dt,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.mediaRecorder&&(e.load=!0,e.mediaRecorder.stop(),n=new Date,c=n.getFullYear(),d=n.getMonth()+1,l=n.getDate(),dt="".concat(l<10?"0"+l:l,"/").concat(d<10?"0"+d:d,"/").concat(c),m=function(e){var t=e.getHours(),n=e.getMinutes(),r=t>=12?"PM":"AM";return(t=(t=(t%=12)||12)<10?"0"+t:t)+":"+(n=n<10?"0"+n:n)+" "+r},e.mediaRecorder.onstop=Object(r.a)(regeneratorRuntime.mark((function t(){var r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=new Blob(e.audioChunks,{type:"audio/mpeg"}),(c=new FormData).append("audio",r,"audio-message.mp3"),c.append("msgType","audio"),c.append("msg",""),c.append("date",dt),c.append("sent_by",e.myname),c.append("time",m(n)),c.append("sender","Coordinator"),c.append("sentby_id",e.$store.state.email),c.append("chatid",e.dataObj.id),t.next=14,o.a.collection("chatMsgs").create(c);case 14:return t.next=16,o.a.collection("chats").update(e.dataObj.id,{lastMsg:"",msgType:"audio",sentby:e.$store.state.email,isRead:!1});case 16:e.mediaRecorder=null,e.load=!1,t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),e.load=!1;case 23:case"end":return t.stop()}}),t,null,[[0,20]])}))),e.mediaRecorder=null);case 1:case"end":return t.stop()}}),t)})))()}}},l=(n(583),n(7)),component=Object(l.a)(d,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[t("section",{staticClass:"chat"},[0==e.loading?t("div",{staticClass:"header-chat"},[t("i",{staticClass:"el-icon-back",on:{click:function(t){return e.backa()}}}),e._v(" "),t("h5",{staticClass:"h5",staticStyle:{padding:"0",margin:"0"}},[e._v("\n            "+e._s(e.dataObj.name)+"\n          ")])]):e._e(),e._v(" "),0==e.loading?t("div",{ref:"chatWindow",staticClass:"messages-chat"},e._l(e.messages,(function(n,i){return t("div",{key:n.id,class:["message"]},[t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",width:"100%"}},[i-1>0&&e.messages[i].date!=e.messages[i-1].date||i-1==-1?t("span",{staticClass:"text-center",staticStyle:{width:"100%","text-align":"center","font-size":"14px"}},[e._v(e._s(n.date))]):e._e()]),e._v(" "),n.sentby_id!=e.$store.state.email?t("div",{staticClass:"text-left"},["text"===n.msgType&&"N/A"!==n.msg?t("p",{staticClass:"text"},[e._v("\n              "+e._s(n.msg)+" "),t("br"),e._v(" "),t("span",{staticStyle:{"font-size":"9px"}},[e._v(e._s(n.sent_by))])]):e._e(),e._v(" "),"audio"===n.msgType||"N/A"===n.msg?t("div",{staticClass:"audio-container"},[t("audio",{staticClass:"audioo",attrs:{src:"https://api.kktel.org/api/files/ejiz05ki7gmq8ns/".concat(n.id,"/").concat(n.audio)||!1,controls:""}}),e._v(" "),t("br"),e._v(" "),t("span",{staticStyle:{"font-size":"9px"}},[e._v(e._s(n.sent_by))])]):e._e(),e._v(" "),t("p",{staticClass:"response-time time"},[e._v(e._s(n.time))])]):e._e(),e._v(" "),n.sentby_id==e.$store.state.email?t("div",{staticClass:"text-right"},["text"===n.msgType&&"N/A"!==n.msg?t("p",{staticClass:"text"},[e._v("\n              "+e._s(n.msg)+" "),t("br"),e._v(" "),t("span",{staticStyle:{"font-size":"9px"}},[e._v(e._s(n.sent_by))])]):e._e(),e._v(" "),"audio"===n.msgType||"N/A"===n.msg?t("div",{staticClass:"audio-container"},[t("audio",{staticClass:"audioo",attrs:{src:"https://api.kktel.org/api/files/ejiz05ki7gmq8ns/".concat(n.id,"/").concat(n.audio)||!1,controls:""}}),e._v(" "),t("br"),e._v(" "),t("span",{staticStyle:{"font-size":"9px"}},[e._v(e._s(n.sent_by))])]):e._e(),e._v(" "),t("p",{staticClass:"response-time time"},[e._v(e._s(n.time))])]):e._e()])})),0):t("div",{staticStyle:{width:"100%",height:"80vh",display:"flex","justify-content":"center","align-items":"center"}},[t("h5",[e._v("Loading...")])]),e._v(" "),t("div",{staticClass:"footer-chat"},[t("i",{staticClass:"icon fa fa-microphone clickable",class:{"recording-active":e.isRecording},attrs:{"aria-hidden":"true"},on:{click:function(t){return e.opp()}}}),e._v(" "),1==e.load?t("p",{staticClass:"spinner"}):e._e(),e._v(" "),e.isRecording?t("span",{staticClass:"recording-indicator"},[t("img",{staticStyle:{"margin-left":"1.5rem",width:"2rem",height:"1rem"},attrs:{src:"img/assets/tenor.gif"}})]):e._e(),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputmessage,expression:"inputmessage"}],staticClass:"write-message",attrs:{type:"text",placeholder:"Type your message here"},domProps:{value:e.inputmessage},on:{input:function(t){t.target.composing||(e.inputmessage=t.target.value)}}}),e._v(" "),t("i",{staticClass:"icon send el-icon-s-promotion clickable",attrs:{"aria-hidden":"true"},on:{click:function(t){return e._send()}}})])])])])])}),[],!1,null,"51422a1a",null);t.default=component.exports}}]);