(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{405:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var c=n(128);var r=n(167),o=n(88);function l(t){return function(t){if(Array.isArray(t))return Object(c.a)(t)}(t)||Object(r.a)(t)||Object(o.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},443:function(t,e,n){},444:function(t,e,n){},537:function(t,e,n){"use strict";n(443)},538:function(t,e,n){"use strict";n(444)},636:function(t,e,n){"use strict";n.r(e);n(20),n(44),n(11);var c=n(405),r=n(10),o=(n(36),n(72),n(166),n(27),n(164),n(24),n(17)),l={layout:"DashboardLayout",middleware:["isAuthenticated","checkAdmin"],data:function(){return{chats:[],ekys:0,chatMsgs:[],obj:null,msg:"",sin:!1,width:0,show:!1,show1:!1,loading:!1,messages:[],myname:"",inputmessage:"",isRecording:!1,mediaRecorder:null,audioChunks:[],load:!1,load1:!0,load2:!1,page:1,dialogVisible:!1,contacts:[]}},methods:{_back:function(){this.$router.replace("/")},deletemsg:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.collection("chatMsgs_staff").delete("".concat(t));case 2:case"end":return e.stop()}}),e)})))()},getData:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,l,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t).width=window.innerWidth,e.next=4,o.a.collection("chats_staff").getList(n.page,10,{sort:"-created",filter:'person1= "'.concat(n.$store.state.cid,'" || person2= "').concat(n.$store.state.cid,'"')});case 4:return r=e.sent,n.chats=r.items,10==n.chats.length&&(n.show1=!0),n.myname=o.a.authStore.model.name,n.load1=!1,o.a.collection("chats_staff").subscribe("*",(function(t){if((t.record.person1==n.$store.state.cid||t.record.person2==n.$store.state.cid)&&("create"==t.action&&(n.chats=[t.record].concat(Object(c.a)(n.chats)),n.keys++),"update"==t.action)){var e=n.chats.findIndex((function(a){return a.id==t.record.id}));-1!=e&&(n.chats[e]=t.record,n.keys++)}}),{}),o.a.collection("chatMsgs_staff").subscribe("*",(function(t){n.subChats(n.obj)}),{}),e.next=13,o.a.collection("Researchers").getFullList();case 13:return l=e.sent,e.next=16,o.a.collection("doctors").getFullList();case 16:return d=e.sent,e.next=19,o.a.collection("cordinator").getFullList();case 19:h=e.sent,n.contacts=[].concat(Object(c.a)(l),Object(c.a)(d),Object(c.a)(h)),n.contacts=n.contacts.filter((function(a){return a.id!=n.$store.state.cid}));case 22:case"end":return e.stop()}}),e)})))()},getChats:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var c,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=e,null==t){n.next=13;break}return c.obj=t,c.show=!0,c.loading=!0,n.next=7,o.a.collection("chats_staff").update(t.id,{isRead:t.sentby!=o.a.authStore.model.id});case 7:return n.next=9,o.a.collection("chatMsgs_staff").getFullList({sort:"created",filter:'chat.id ?="'.concat(t.id,'"')});case 9:r=n.sent,c.chatMsgs=r,c.loading=!1,c.scrollToBottom();case 13:case"end":return n.stop()}}),n)})))()},subChats:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var c,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=e,null==t){n.next=7;break}return n.next=4,o.a.collection("chatMsgs_staff").getFullList({sort:"created",filter:'chat.id ?="'.concat(t.id,'"')});case 4:r=n.sent,c.chatMsgs=r;try{c.scrollToBottom()}catch(t){}case 7:case"end":return n.stop()}}),n)})))()},scrollToBottom:function(){var t=this;try{t.$nextTick((function(){var e=t.$refs.chatWindow;e.scrollTop=e.scrollHeight}))}catch(t){}},_view:function(t){window.open(t,"_blank")},_send:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,c,r,dd,l,d,dt,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,c=function(t){var e=t.getHours(),n=t.getMinutes(),c=e>=12?"PM":"AM";return(e=(e=(e%=12)||12)<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)+" "+c},r=new Date,dd=r.getDate(),l=r.getMonth()+1,d=r.getFullYear(),dt="".concat(dd<10?"0"+dd:dd,"/").concat(l<10?"0"+l:l,"/").concat(d),data={msg:n.msg,msgType:"text",date:dt,time:c(r),sent_by:n.myname,sentby_id:n.$store.state.cid,chat:[n.obj.id]},e.next=10,o.a.collection("chatMsgs_staff").create(data);case 10:return e.next=12,o.a.collection("chats_staff").update(n.obj.id,{lastMsg:n.msg,msgType:"text",sentby:t.$store.state.cid,isRead:!1});case 12:n.msg="";case 13:case"end":return e.stop()}}),e)})))()},showFirstTenWords:function(text){var t=text.split(" "),e=t.slice(0,5).join(" ");return e.split(" ").length<t.length&&(e+=" ..."),e},_show:function(){var t=this;return t.width<=999&&0==t.show||!(t.width<=999&&1==t.show)&&(t.width>999||void 0)},_show1:function(){var t=this;return null!=t.obj&&(!(t.width<=999&&0==t.show)&&(t.width<=999&&1==t.show||t.width>999||console.log("first"),!0))},_show2:function(){var t=this;return null==t.obj&&(!(t.width<=999&&0==t.show)&&(t.width<=999&&1==t.show||t.width,!0))},opp:function(){this.isRecording=!this.isRecording,1==this.isRecording?this.startRecording():0==this.isRecording&&this.stopRecording()},startRecording:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:n=e.sent,t.mediaRecorder=new MediaRecorder(n),t.audioChunks=[],t.mediaRecorder.ondataavailable=function(e){t.audioChunks.push(e.data)},t.mediaRecorder.start(),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,10]])})))()},stopRecording:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,c,l,d,dt,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.mediaRecorder&&(t.load=!0,t.mediaRecorder.stop(),n=new Date,c=n.getFullYear(),l=n.getMonth()+1,d=n.getDate(),dt="".concat(d<10?"0"+d:d,"/").concat(l<10?"0"+l:l,"/").concat(c),h=function(t){var e=t.getHours(),n=t.getMinutes(),c=e>=12?"PM":"AM";return(e=(e=(e%=12)||12)<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)+" "+c},t.mediaRecorder.onstop=Object(r.a)(regeneratorRuntime.mark((function e(){var c,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=new Blob(t.audioChunks,{type:"audio/mpeg"}),(r=new FormData).append("audio",c,"audio-message.mp3"),r.append("msgType","audio"),r.append("msg",""),r.append("date",dt),r.append("sent_by",t.myname),r.append("time",h(n)),r.append("sentby_id",t.$store.state.cid),r.append("chat",[t.obj.id]),e.next=13,o.a.collection("chatMsgs_staff").create(r);case 13:return e.next=15,o.a.collection("chats_staff").update(t.obj.id,{lastMsg:"",msgType:"audio",sentby:t.$store.state.cid,isRead:!1});case 15:t.mediaRecorder=null,t.load=!1,e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),t.load=!1;case 22:case"end":return e.stop()}}),e,null,[[0,19]])}))),t.mediaRecorder=null);case 1:case"end":return e.stop()}}),e)})))()},_loadMore:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t).page++,n.load2=!0,e.next=5,o.a.collection("chats_staff").getList(n.page,10,{sort:"-created",filter:'person1= "'.concat(n.$store.state.cid,'" || person2= "').concat(n.$store.state.cid,'"')});case 5:r=e.sent,n.chats=[].concat(Object(c.a)(n.chats),Object(c.a)(r.items)),10==r.items.length?n.show1=!0:n.show1=!1,n.load2=!1;case 9:case"end":return e.stop()}}),e)})))()},_new:function(){this.dialogVisible=!0},_newChat:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var c,r,l,d,dd,h,f,dt,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=e,n.prev=1,n.next=4,o.a.collection("chats_staff").getFirstListItem('idd="'.concat(o.a.authStore.model.id,"_").concat(t.id,'" || idd="').concat(t.id,"_").concat(o.a.authStore.model.id,'"'));case 4:r=n.sent,c.getChats(r),c.dialogVisible=!1,n.next=20;break;case 9:return n.prev=9,n.t0=n.catch(1),l=function(t){var e=t.getHours(),n=t.getMinutes(),c=e>=12?"PM":"AM";return(e=(e=(e%=12)||12)<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)+" "+c},d=new Date,dd=d.getDate(),h=d.getMonth()+1,f=d.getFullYear(),dt="".concat(dd<10?"0"+dd:dd,"/").concat(h<10?"0"+h:h,"/").concat(f),data={name:o.a.authStore.model.name,name1:t.name,date:dt,time:l(d),lastMsg:"",msgType:"text",person1:o.a.authStore.model.id,person2:t.id,sentby:o.a.authStore.model.id,isRead:!1,idd:"".concat(o.a.authStore.model.id,"_").concat(t.id)},n.next=20,o.a.collection("chats_staff").create(data).then((function(t){c.getChats(t),c.dialogVisible=!1}));case 20:case"end":return n.stop()}}),n,null,[[1,9]])})))()}},mounted:function(){this.getData()}},d=(n(537),n(538),n(7)),component=Object(d.a)(l,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"container-fluid"},[e("span",{staticClass:"bg-white mt-2 d-flex",staticStyle:{cursor:"pointer"},on:{click:function(e){return t._back()}}},[e("i",{staticClass:"fa fa-arrow-left text-black",staticStyle:{"font-size":"19px","margin-top":"3px"}}),t._v(" "),e("h4",{staticClass:"ml-3"},[t._v("Chats")])]),t._v(" "),e("div",{staticClass:"container row clearfix"},[t._show()?e("div",{class:{"people-list":!0,"col-md-4":t.width>999,"col-md-12":t.width<=999},attrs:{id:"people-list"}},[0!=t.chats.length?e("ul",{key:t.keys,staticClass:"list"},[e("li",{staticStyle:{display:"flex","justify-content":"space-between"}},[e("p"),t._v(" "),e("button",{staticClass:"btn btn-sm text-white border-white",attrs:{type:"button"},on:{click:function(e){return t._new()}}},[t._v("\n            New\n          ")])]),t._v(" "),t._l(t.chats,(function(n,i){return e("li",{key:i,staticClass:"clearfix",on:{click:function(e){return t.getChats(n)}}},[e("img",{staticStyle:{width:"50px",height:"50px"},attrs:{src:"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:"avatar"}}),t._v(" "),e("div",{staticClass:"about"},[e("div",{staticClass:"name text-white text-truncate"},[t._v("\n              "+t._s(t.$store.state.cid==n.person1?n.name1:n.name)+"\n               \n              "),0==n.isRead&&n.sentby!=t.$store.state.cid?e("i",{staticClass:"fa fa-circle online"}):t._e()]),t._v(" "),"text"==n.msgType?e("div",{staticClass:"name text-white"},[t._v("\n              "+t._s(t.showFirstTenWords(n.lastMsg))+"\n            ")]):e("div",{staticClass:"d-flex"},[e("i",{staticClass:"fas fa-file-audio",staticStyle:{color:"white","margin-right":"7px","margin-top":"5px"}}),t._v(" "),e("p",{staticClass:"text-white"},[t._v("Audio File")])])])])}))],2):t._e(),t._v(" "),1==t.show1?e("div",{staticStyle:{display:"flex"}},[e("button",{staticClass:"btn btn-white btn-sm d-flex",staticStyle:{width:"100%","justify-content":"center","align-items":"center"},on:{click:function(e){return t._loadMore()}}},[1==t.load2?e("p",{staticClass:"spinner mr-4"}):t._e(),t._v("\n          "+t._s(1==t.load2?"Loading":"Load")+"\n        ")])]):t._e(),t._v(" "),0==t.chats.length&&0==t.load1?e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"100%"}},[e("h4",{staticClass:"text-white"},[t._v("No Chats")])]):t._e(),t._v(" "),1==t.load1?e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"100%"}},[e("h4",{staticClass:"text-white"},[t._v("Loading...")])]):t._e()]):t._e(),t._v(" "),t._show1()?e("div",{class:{chat:!0,"col-md-8":t.width>999,"col-md-12":t.width<=999}},[e("div",{staticClass:"chat-header clearfix"},[t.width<=999?e("div",{staticClass:"chat-about"},[e("div",{staticClass:"chat-with mr-4"},[e("i",{staticClass:"fa fa-arrow-left",on:{click:function(e){t.show=!1,t.obj=null}}})])]):t._e(),t._v(" "),e("img",{staticStyle:{width:"45px",height:"45px"},attrs:{src:"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:"avatar"}}),t._v(" "),e("div",{staticClass:"chat-about"},[e("div",{staticClass:"chat-with"},[t._v("\n            "+t._s(t.$store.state.cid==t.obj.person1?t.obj.name1:t.obj.name)+"\n          ")])])]),t._v(" "),e("div",{ref:"chatWindow",staticClass:"chat-history"},[0==t.loading?e("div",t._l(t.chatMsgs,(function(n,i){return e("ul",{key:i},[e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[i-1>0&&t.chatMsgs[i].date!=t.chatMsgs[i-1].date||i-1==-1?e("span",{staticClass:"text-center",staticStyle:{width:"100%","text-align":"center","font-size":"14px"}},[t._v(t._s(n.date))]):t._e()]),t._v(" "),n.sentby_id==t.$store.state.cid?e("li",{staticClass:"clearfix"},[e("div",{staticClass:"message-data align-right"},[e("span",{staticClass:"message-data-time"},[t._v(t._s(n.time))]),t._v(" "),e("p",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.deletemsg(n.id)}}},[e("i",{staticClass:"el-icon-delete"})])]),t._v(" "),e("div",{staticClass:"message other-message float-right"},["text"==n.msgType?e("span",[t._v("\n                  "+t._s(n.msg)+"\n                  "),e("p",{staticStyle:{"font-size":"12px"}},[t._v(t._s(n.sent_by))])]):e("div",[e("audio",{staticClass:".audio-player",attrs:{src:"https://api.kktel.org/api/files/chatMsgs_staff/".concat(n.id,"/").concat(n.audio)||!1,controls:""}}),t._v(" "),e("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(n.sent_by))])])])]):e("li",[e("div",{staticClass:"message-data"},[e("span",{staticClass:"message-data-time"},[t._v(t._s(n.time))]),t._v(" "),e("p",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.deletemsg(n.id)}}},[e("i",{staticClass:"el-icon-delete"})])]),t._v(" "),e("div",{staticClass:"message my-message"},["text"==n.msgType?e("span",[t._v("\n                  "+t._s(n.msg)+"\n                  "),e("p",{staticStyle:{"font-size":"12px"}},[t._v(t._s(n.sent_by))])]):e("div",[e("audio",{attrs:{src:"https://api.kktel.org/api/files/chatMsgs_staff/".concat(n.id,"/").concat(n.audio)||!1,controls:""}}),t._v(" "),e("p",{staticStyle:{"font-size":"12px"}},[t._v(t._s(n.sent_by))])])])])])})),0):e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"100%"}},[e("h3",[t._v("Loading...")])])]),t._v(" "),e("div",{staticClass:"chat-message clearfix"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msg,expression:"msg"}],attrs:{name:"message-to-send",id:"message-to-send",placeholder:"Type your message",rows:"3"},domProps:{value:t.msg},on:{input:function(e){e.target.composing||(t.msg=e.target.value)}}}),t._v(" "),e("div",{staticClass:"d-flex",staticStyle:{"justify-content":"space-between"}},[e("div",{staticClass:"d-flex"},[e("i",{staticClass:"icon fa fa-microphone clickable mt-3",class:{"recording-active":t.isRecording},staticStyle:{cursor:"pointer"},attrs:{"aria-hidden":"true",disabled:t.load},on:{click:function(e){return t.opp()}}}),t._v(" "),t.isRecording?e("span",{staticClass:"recording-indicator"},[e("img",{staticStyle:{"margin-left":"1.5rem",width:"2rem",height:"1rem","margin-top":"1rem"},attrs:{src:"img/assets/tenor.gif"}})]):t._e(),t._v(" "),1==t.load?e("p",{staticClass:"spinner",staticStyle:{"margin-top":"1rem"}}):t._e()]),t._v(" "),e("button",{attrs:{type:"button"},on:{click:function(e){return t._send()}}},[t._v("Send")])])])]):t._e(),t._v(" "),t._show2()?e("div",{class:{chat:!0,"col-md-8":t.width>999,"col-md-12":t.width<=999},staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"770px"}},[e("h4",[t._v("Chats Empty")])]):t._e()]),t._v(" "),e("modal",{attrs:{show:t.dialogVisible,size:"sm"},on:{"update:show":function(e){t.dialogVisible=e}}},[e("h6",{staticClass:"modal-title",attrs:{slot:"header"},slot:"header"},[t._v("Contacts")]),t._v(" "),e("div",{staticClass:"col-md-12",staticStyle:{"max-height":"600px","overflow-y":"hidden"}},t._l(t.contacts,(function(n){return e("div",{key:n.id,staticClass:"pt-2 pb-2 d-flex mb-2",staticStyle:{cursor:"pointer"},on:{click:function(e){return t._newChat(n)}}},[e("img",{staticStyle:{width:"40px",height:"40px"},attrs:{src:"https://cdn-icons-png.flaticon.com/512/149/149071.png",alt:"avatar"}}),t._v(" "),e("h4",{staticClass:"ml-2 mt-1"},[t._v(t._s(n.name))])])})),0)])],1)}),[],!1,null,"9ea44f6e",null);e.default=component.exports}}]);