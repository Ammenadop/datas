(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{489:function(t,e,n){},592:function(t,e,n){"use strict";n(489)},659:function(t,e,n){"use strict";n.r(e);n(11);var r=n(10),c=n(9),o=(n(36),n(71),n(62),n(17)),d={data:function(){var t;return t={messages:[],myname:"",inputmessage:"",isRecording:!1,mediaRecorder:null,audioChunks:[],dataObj:null,loading:!0,load:!1},Object(c.a)(t,"myname",""),Object(c.a)(t,"corid",""),t},mounted:function(){this.getData()},methods:{backa:function(){history.back()},getData:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,o.a.collection("cordinator").getFirstListItem('email="'.concat(n.$store.state.email,'"'),{});case 3:return r=e.sent,n.myname=r.name,e.next=7,o.a.collection("doctor_pc_chats").getOne(n.$route.params.id);case 7:return n.dataObj=e.sent,n.subChats(n.dataObj),o.a.collection("chatMsgs_doctor_pc").subscribe("*",(function(t){t.record.chat.includes(n.dataObj.id)&&n.subChats(n.dataObj)}),{}),n.loading=!1,e.next=13,o.a.collection("doctor_pc_chats").update(n.dataObj.id,{isRead:n.dataObj.sentby!=n.$store.state.cid});case 13:case"end":return e.stop()}}),e)})))()},subChats:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e,null==t){n.next=7;break}return n.next=4,o.a.collection("chatMsgs_doctor_pc").getFullList({sort:"-created",filter:'chat.id ?="'.concat(t.id,'"')});case 4:c=n.sent,r.messages=c,r.scrollToBottom();case 7:case"end":return n.stop()}}),n)})))()},scrollToBottom:function(){var t=this;try{t.$nextTick((function(){var e=t.$refs.chatWindow;e.scrollTop=e.scrollHeight}))}catch(t){}},_send:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,c,dd,d,l,dt,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!=(n=t).inputmessage.trim()){e.next=3;break}return e.abrupt("return");case 3:return r=function(t){var e=t.getHours(),n=t.getMinutes(),r=e>=12?"PM":"AM";return(e=(e=(e%=12)||12)<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)+" "+r},c=new Date,dd=c.getDate(),d=c.getMonth()+1,l=c.getFullYear(),dt="".concat(dd<10?"0"+dd:dd,"/").concat(d<10?"0"+d:d,"/").concat(l),data={msg:n.inputmessage,msgType:"text",date:dt,time:r(c),sent_by:n.myname,sentby_id:n.$store.state.cid,chat:[n.dataObj.id],tid:n.dataObj.treatmentID},e.next=12,o.a.collection("chatMsgs_doctor_pc").create(data);case 12:return e.next=14,o.a.collection("doctor_pc_chats").update(t.dataObj.id,{lastMsg:n.inputmessage,msgType:"text",sentby:t.$store.state.cid,isRead:!1});case 14:n.inputmessage="";case 15:case"end":return e.stop()}}),e)})))()},opp:function(){this.isRecording=!this.isRecording,1==this.isRecording?this.startRecording():0==this.isRecording&&this.stopRecording()},startRecording:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:n=e.sent,t.mediaRecorder=new MediaRecorder(n),t.audioChunks=[],t.mediaRecorder.ondataavailable=function(e){t.audioChunks.push(e.data)},t.mediaRecorder.start(),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,10]])})))()},stopRecording:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,c,d,l,dt,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.mediaRecorder&&(t.load=!0,t.mediaRecorder.stop(),n=new Date,c=n.getFullYear(),d=n.getMonth()+1,l=n.getDate(),dt="".concat(l<10?"0"+l:l,"/").concat(d<10?"0"+d:d,"/").concat(c),m=function(t){var e=t.getHours(),n=t.getMinutes(),r=e>=12?"PM":"AM";return(e=(e=(e%=12)||12)<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)+" "+r},t.mediaRecorder.onstop=Object(r.a)(regeneratorRuntime.mark((function e(){var r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Blob(t.audioChunks,{type:"audio/mpeg"}),(c=new FormData).append("audio",r,"audio-message.mp3"),c.append("msgType","audio"),c.append("msg",""),c.append("date",dt),c.append("sent_by",t.myname),c.append("time",m(n)),c.append("sentby_id",t.$store.state.cid),c.append("chat",[t.dataObj.id]),c.append("tid",t.dataObj.treatmentID),e.next=14,o.a.collection("chatMsgs_doctor_pc").create(c);case 14:return e.next=16,o.a.collection("doctor_pc_chats").update(t.dataObj.id,{lastMsg:"",msgType:"audio",sentby:t.$store.state.cid,isRead:!1});case 16:t.mediaRecorder=null,t.load=!1,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),t.load=!1;case 23:case"end":return e.stop()}}),e,null,[[0,20]])}))),t.mediaRecorder=null);case 1:case"end":return e.stop()}}),e)})))()}}},l=(n(592),n(7)),component=Object(l.a)(d,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},[e("section",{staticClass:"chat"},[0==t.loading?e("div",{staticClass:"header-chat",staticStyle:{display:"block"}},[e("div",{staticStyle:{display:"flex","margin-top":"1rem"}},[e("i",{staticClass:"el-icon-back",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.backa()}}}),t._v(" "),e("h5",{staticClass:"h5 ml-2",staticStyle:{padding:"0",margin:"0"}},[t._v("\n            "+t._s(t.dataObj.name)+" ("+t._s(t.dataObj.patientID)+")\n          ")])]),t._v(" "),e("h5",{staticClass:"h5 ml-4",staticStyle:{padding:"0",margin:"0"}},[t._v("\n            "+t._s(t.dataObj.treatmentID)+", "+t._s(t.dataObj.disease)+" "+t._s(""!=t.dataObj.disease_type?"(".concat(t.dataObj.disease_type,")"):"")+"\n          ")]),e("br")]):t._e(),t._v(" "),0==t.loading?e("div",{ref:"chatWindow",staticClass:"messages-chat"},t._l(t.messages,(function(n,i){return e("div",{key:n.id,class:["message"]},[e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",width:"100%"}},[i-1>0&&t.messages[i].date!=t.messages[i-1].date||i-1==-1?e("span",{staticClass:"text-center",staticStyle:{width:"100%","text-align":"center","font-size":"14px"}},[t._v(t._s(n.date))]):t._e()]),t._v(" "),n.sentby_id!=t.$store.state.cid?e("div",{staticClass:"text-left"},["text"===n.msgType&&"N/A"!==n.msg?e("p",{staticClass:"text"},[t._v("\n              "+t._s(n.msg)+" "),e("br"),t._v(" "),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(n.sent_by))])]):t._e(),t._v(" "),"audio"===n.msgType||"N/A"===n.msg?e("div",{staticClass:"audio-container"},[e("audio",{staticClass:"audioo",attrs:{src:"https://api.kktel.org/api/files/chatMsgs_doctor_pc/".concat(n.id,"/").concat(n.audio)||!1,controls:""}}),t._v(" "),e("br"),t._v(" "),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(n.sent_by))])]):t._e(),t._v(" "),e("p",{staticClass:"response-time time"},[t._v(t._s(n.time))])]):t._e(),t._v(" "),n.sentby_id==t.$store.state.cid?e("div",{staticClass:"text-right"},["text"===n.msgType&&"N/A"!==n.msg?e("p",{staticClass:"text"},[t._v("\n              "+t._s(n.msg)+" "),e("br"),t._v(" "),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(n.sent_by))])]):t._e(),t._v(" "),"audio"===n.msgType||"N/A"===n.msg?e("div",{staticClass:"audio-container"},[e("audio",{staticClass:"audioo",attrs:{src:"https://api.kktel.org/api/files/chatMsgs_doctor_pc/".concat(n.id,"/").concat(n.audio)||!1,controls:""}}),t._v(" "),e("br"),t._v(" "),e("span",{staticStyle:{"font-size":"9px"}},[t._v(t._s(n.sent_by))])]):t._e(),t._v(" "),e("p",{staticClass:"response-time time"},[t._v(t._s(n.time))])]):t._e()])})),0):e("div",{staticStyle:{width:"100%",height:"80vh",display:"flex","justify-content":"center","align-items":"center"}},[e("h5",[t._v("Loading...")])]),t._v(" "),e("div",{staticClass:"footer-chat"},[e("i",{staticClass:"icon fa fa-microphone clickable",class:{"recording-active":t.isRecording},attrs:{"aria-hidden":"true"},on:{click:function(e){return t.opp()}}}),t._v(" "),1==t.load?e("p",{staticClass:"spinner"}):t._e(),t._v(" "),t.isRecording?e("span",{staticClass:"recording-indicator"},[e("img",{staticStyle:{"margin-left":"1.5rem",width:"2rem",height:"1rem"},attrs:{src:"img/assets/tenor.gif"}})]):t._e(),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.inputmessage,expression:"inputmessage"}],staticClass:"write-message",attrs:{type:"text",placeholder:"Type your message here"},domProps:{value:t.inputmessage},on:{input:function(e){e.target.composing||(t.inputmessage=e.target.value)}}}),t._v(" "),e("i",{staticClass:"icon send el-icon-s-promotion clickable",attrs:{"aria-hidden":"true"},on:{click:function(e){return t._send()}}})])])])])])}),[],!1,null,"7940e459",null);e.default=component.exports}}]);